<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>gitcreds for package authors • gitcreds</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="gitcreds for package authors">
<meta name="robots" content="noindex">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script><script defer data-domain="gitcreds.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gitcreds</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/package.html">For package authors</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/gitcreds/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>gitcreds for package authors</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/gitcreds/blob/main/vignettes/package.Rmd" class="external-link"><code>vignettes/package.Rmd</code></a></small>
      <div class="d-none name"><code>package.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>If you have a package that queries the GitHub API, or uses git with
remote git repositories, then most likely you need to let your users
specify their GitHub or git credentials. There are several benefits of
using gitcreds to do this:</p>
<ul>
<li><p>(Re)use the same credentials as command line git, R and the
RStudio IDE., etc. Users can set their GitHub token once and use it
everywhere.</p></li>
<li><p>Users can use the same credentials for multiple R
packages.</p></li>
<li><p>gitcreds has a cache that makes credential lookup very
fast.</p></li>
<li><p>Typically more secure than storing passwords and tokens in
<code>.Renviron</code> files.</p></li>
<li><p>gitcreds supports multiple users and multiple hosts.</p></li>
<li><p>If git or credential helpers are not available, e.g. typically on
a Linux server, then gitcreds can still use environment variables, and
it still supports multiple users and hosts.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="the-simple-api">The simple API<a class="anchor" aria-label="anchor" href="#the-simple-api"></a>
</h2>
<p>The simplest way to use gitcreds is to call
<code><a href="../reference/gitcreds_get.html">gitcreds_get()</a></code> from your package to query credentials,
possibly with a custom URL. For setting new credentials, you can point
your users to <code><a href="../reference/gitcreds_get.html">gitcreds_set()</a></code>.</p>
<div class="section level3">
<h3 id="errors-from-the-simple-api">Errors from the simple API<a class="anchor" aria-label="anchor" href="#errors-from-the-simple-api"></a>
</h3>
<p>If you are using the simple API, gitcreds may throw the following
classed errors and your package might want to handle:</p>
<ul>
<li><p><code>gitcreds_nogit_error</code> if git it not available on the
system.</p></li>
<li><p><code>gitcreds_no_credentials</code> if git did not find any
credentials for the specified URL. The URL is stored in the error, under
<code>url</code>.</p></li>
<li>
<p><code>git_error</code> if a git command returned some error. The
following information is stored in the error object:</p>
<ul>
<li><p><code>args</code> the command line arguments to git,</p></li>
<li><p><code>stdout</code> standard output,</p></li>
<li><p><code>stderr</code> standard error,</p></li>
<li><p><code>status</code> the exit status of the git process.</p></li>
</ul>
</li>
<li><p><code>gitcreds_not_interactive_error</code> if
<code><a href="../reference/gitcreds_get.html">gitcreds_set()</a></code> is called in non-interactive mode.</p></li>
<li><p><code>gitcreds_abort_replace_error</code> if the user aborted
replacing the existing credentials.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="the-low-level-api">The low level API<a class="anchor" aria-label="anchor" href="#the-low-level-api"></a>
</h2>
<p>Should you need more flexibility, you can use the
<code><a href="../reference/gitcreds-api.html">gitcreds_approve()</a></code>, <code><a href="../reference/gitcreds-api.html">gitcreds_fill()</a></code> and
<code><a href="../reference/gitcreds-api.html">gitcreds_reject()</a></code> functions, to add/update, query and
remove credentials. We suggest you use the dummy credential helper (see
below) for <code><a href="../reference/gitcreds-api.html">gitcreds_fill()</a></code>, to avoid git password dialog
boxes if a credential is not available.</p>
<p>E.g. the low level API makes it possible to implement an alternative
to <code><a href="../reference/gitcreds_get.html">gitcreds_set()</a></code> , with a different user interface, or a
version that also works in non-interactive sessions.</p>
<div class="section level3">
<h3 id="the-dummy-credential-helper">The dummy credential helper<a class="anchor" aria-label="anchor" href="#the-dummy-credential-helper"></a>
</h3>
<p>In a typical setup, if git does not find credentials for the
requested host after querying all defined credential helpers, it’ll ask
for a password in a dialog box, or a terminal prompt. It is often best
to avoid these, and deal with the situation within R.</p>
<p>gitcreds has a dummy credential helper, that always supplies dummy
credentials. By default <code><a href="../reference/gitcreds-api.html">gitcreds_fill()</a></code> adds this dummy
helper to the list of configured credential helpers, and code calling
<code><a href="../reference/gitcreds-api.html">gitcreds_fill()</a></code> can check if git returned the dummy
credentials, meaning that no real credentials were found. This is how
the dummy credentials look:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gitcreds-api.html">gitcreds_fill</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>url<span class="op">=</span><span class="st">"https://impossible.com"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "protocol=dummy"     "host=dummy"</span></span>
<span><span class="co">#&gt; [3] "username=dummy"     "password=dummy get"</span></span></code></pre></div>
<p>It is best to look for <code>protocol=dummy</code> as the first line
of the git output.</p>
</div>
<div class="section level3">
<h3 id="errors-from-the-low-level-api">Errors from the low level API<a class="anchor" aria-label="anchor" href="#errors-from-the-low-level-api"></a>
</h3>
<ul>
<li>
<p><code>git_error</code> if a git command returned some error. The
following information is stored in the error object:</p>
<ul>
<li><p><code>args</code> the command line arguments to git,</p></li>
<li><p><code>stdout</code> standard output,</p></li>
<li><p><code>stderr</code> standard error,</p></li>
<li><p><code>status</code> the exit status of the git process.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h2>
<p>If your package uses gitcreds, either directly, or through another
package, then you might want to test your package for the the various
possible states of the user’s git installation and credential store.
gitcreds has some facilities to help you with this.</p>
<p>If you want to test your package for a specific output from gitcreds,
you can temporarily set the environment variable that gitcreds uses as a
cache to the desired value. Use the <code><a href="../reference/gitcreds_cache_envvar.html">gitcreds_cache_envvar()</a></code>
function to see which environment variable you need to set for a
url:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gitcreds</span><span class="fu">::</span><span class="fu"><a href="../reference/gitcreds_cache_envvar.html">gitcreds_cache_envvar</a></span><span class="op">(</span><span class="st">"https://github.com"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "GITHUB_PAT_GITHUB_COM"</span></span></code></pre>
<p>It is easiest to use the withr package to temporarily change this
environment variable in a test case:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"bad credentials from git"</span>, <span class="op">{</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_envvar.html" class="external-link">local_envvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>GITHUB_PAT_GITHUB_COM <span class="op">=</span> <span class="st">"bad"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Test code that calls gitcreds_get(), potentially downstream.</span></span>
<span>  <span class="co"># gitcreds_get() will return `bad` as the password.</span></span>
<span>  <span class="co"># Illustration:</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span></span>
<span>    <span class="fu">gitcreds</span><span class="fu">::</span><span class="fu"><a href="../reference/gitcreds_get.html">gitcreds_get</a></span><span class="op">(</span><span class="st">"https://github.com"</span><span class="op">)</span><span class="op">$</span><span class="va">password</span>,</span>
<span>    <span class="st">"bad"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">Test passed</span> 🥇</span></span></code></pre>
<p>If you want gitcreds to return a specific credential record, then you
can specify the fields of the record in the environment variable,
separated by colons. For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"another GitHub user"</span>, <span class="op">{</span></span>
<span>  <span class="va">cred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"protocol:https:"</span>,</span>
<span>    <span class="st">"host:github.com:"</span>,</span>
<span>    <span class="st">"username:user1:"</span>,</span>
<span>    <span class="st">"password:secret"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_envvar.html" class="external-link">local_envvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>GITHUB_PAT_GITHUB_COM <span class="op">=</span> <span class="va">cred</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Your test code comes here. This is just an illustration:</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">gitcreds</span><span class="fu">::</span><span class="fu"><a href="../reference/gitcreds_get.html">gitcreds_get</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="fu">gitcreds</span><span class="fu">::</span><span class="fu"><a href="../reference/gitcreds_get.html">gitcreds_get</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">username</span>, <span class="st">"user1"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;gitcreds&gt;</span></span>
<span><span class="co">##   protocol: https</span></span>
<span><span class="co">##   host    : github.com</span></span>
<span><span class="co">##   username: user1</span></span>
<span><span class="co">##   password: &lt;-- hidden --&gt;</span></span>
<span><span class="co">## <span style="color: #00BB00;">Test passed</span> 🎊</span></span></code></pre>
<p>If you want gitcreds to fail for a specific host, set the
corresponding environment variable to <code>"FAIL"</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"no credentials from git"</span>, <span class="op">{</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_envvar.html" class="external-link">local_envvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>GITHUB_PAT_GITHUB_COM <span class="op">=</span> <span class="st">"FAIL"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># The test code that calls gitcreds_get() comes here.</span></span>
<span>  <span class="co"># It will fail with error "gitcreds_no_credentials"</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error</a></span><span class="op">(</span></span>
<span>    <span class="fu">gitcreds</span><span class="fu">::</span><span class="fu"><a href="../reference/gitcreds_get.html">gitcreds_get</a></span><span class="op">(</span><span class="st">"https://github.com"</span><span class="op">)</span>,</span>
<span>    class <span class="op">=</span> <span class="st">"gitcreds_no_credentials"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">Test passed</span> 🌈</span></span></code></pre>
<p>If you want gitcreds to fail with a specific error, then include the
error class after a <code>"FAIL:"</code> prefix, in the environment
variable. See the list of possible error classes above. For example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"no git installation"</span>, <span class="op">{</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_envvar.html" class="external-link">local_envvar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    GITHUB_PAT_GITHUB_COM <span class="op">=</span> <span class="st">"FAIL:gitcreds_nogit_error"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Test code that calls gitcreds_get() comes here.</span></span>
<span>  <span class="co"># Illustration:</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error</a></span><span class="op">(</span></span>
<span>    <span class="fu">gitcreds</span><span class="fu">::</span><span class="fu"><a href="../reference/gitcreds_get.html">gitcreds_get</a></span><span class="op">(</span><span class="st">"https://github.com"</span><span class="op">)</span>,</span>
<span>    class <span class="op">=</span> <span class="st">"gitcreds_nogit_error"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">Test passed</span> 🎊</span></span></code></pre>
<p>It is not currently possible to simulate the additional data in the
error object, e.g. the standard output of a failed git command. If you
need this for a test case, then your test case can call
<code><a href="../reference/gitcreds_get.html">gitcreds_get()</a></code> directly and you can use the mockery package
to make gitcreds fail with the desired error object.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
